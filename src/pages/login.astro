---
import Layout from "../layouts/Layout.astro";

let error = "";

if (Astro.request.method === "POST") {
  try {
    const data = await Astro.request.formData();
    const password = data.get("password");

    // Password simple para vecinos
    if (password === "ocaso43adm") {
      Astro.cookies.set("ocaso_session", "active", {
        path: "/",
        maxAge: 60 * 60 * 24 * 7, // 1 semana
      });
      return Astro.redirect("/");
    } else {
      error = "Acceso denegado. Verifique su contraseña.";
    }
  } catch (e) {
    if (e instanceof Error) {
      error = e.message;
    }
  }
}
---

<Layout
  title="Acceso Residentes"
  description="Portal de acceso exclusivo para los residentes de Ocaso No. 43. Ingrese su código para consultar minutas y documentos oficiales."
>
  <div class="max-w-xl mx-auto mt-12 mb-24">
    <div
      class="relative group p-1 lg:p-2 rounded-[3.5rem] bg-gradient-to-br from-orange-400 via-pink-500 to-violet-600 shadow-2xl shadow-orange-200 overflow-hidden"
    >
      <div
        class="absolute inset-0 bg-white/20 backdrop-blur-3xl group-hover:scale-110 transition-transform duration-700"
      >
      </div>

      <div class="relative bg-white rounded-[3rem] p-8 sm:p-12 lg:p-16">
        <div class="flex flex-col items-center mb-12">
          <div
            class="w-16 h-16 rounded-2xl bg-orange-50 flex items-center justify-center text-orange-500 mb-6 font-black text-2xl italic shadow-inner"
          >
            O
          </div>
          <h1
            class="text-4xl font-black text-slate-900 mb-3 tracking-tighter text-center"
          >
            Acceso Comunidad
          </h1>
          <p
            class="text-slate-400 text-center font-bold text-xs uppercase tracking-[0.3em] leading-relaxed"
          >
            Administración Ocaso 43
          </p>
        </div>

        <form method="POST" class="space-y-8">
          <div class="space-y-2">
            <label
              for="password"
              class="block text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] ml-2"
              >Contraseña del Edificio</label
            >
            <input
              type="password"
              name="password"
              id="password"
              required
              class="w-full px-6 py-5 rounded-2xl bg-slate-50 border-2 border-transparent focus:border-orange-500 focus:bg-white outline-none transition-all font-bold text-slate-900 placeholder:text-slate-300 shadow-inner"
              placeholder="Ingrese código de acceso"
            />
          </div>

          {
            error && (
              <div class="flex items-center gap-3 p-4 rounded-xl bg-red-50 text-red-500 border border-red-100 animate-shake">
                <span class="text-lg">×</span>
                <p class="text-[11px] font-black uppercase tracking-widest">
                  {error}
                </p>
              </div>
            )
          }

          <button
            type="submit"
            class="w-full h-16 bg-slate-900 text-white font-black text-xs uppercase tracking-[0.4em] rounded-2xl hover:bg-orange-600 hover:scale-[1.02] active:scale-95 transition-all shadow-xl shadow-slate-900/10"
          >
            Entrar al Portal
          </button>
        </form>

        <div class="mt-12 pt-10 border-t border-slate-50 text-center">
          <p
            class="text-[10px] text-slate-300 font-bold uppercase tracking-widest leading-loose"
          >
            Si no cuenta con su acceso, favor de solicitarlo al administrador.
          </p>
        </div>
      </div>
    </div>
  </div>
</Layout>

<style>
  @keyframes shake {
    0%,
    100% {
      transform: translateX(0);
    }
    25% {
      transform: translateX(-4px);
    }
    75% {
      transform: translateX(4px);
    }
  }
  .animate-shake {
    animation: shake 0.3s ease-in-out;
  }
</style>
